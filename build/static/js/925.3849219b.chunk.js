"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[925],{80905:(e,t,i)=>{i.d(t,{j:()=>c});var r=i(9950),n=i(95491),l=i.n(n),s=i(99674),a=i(90650),o=i(44414);const c=e=>{let{fetchOptions:t,debounceTimeout:i=400,hasMore:n,...c}=e;const[d,u]=(0,r.useState)(!1),[m,p]=(0,r.useState)([]),[h,v]=(0,r.useState)(!1),[j,g]=(0,r.useState)(null),[x,A]=(0,r.useState)(1),y=(0,r.useMemo)((()=>l()((e=>{p([]),g(e),u(!0),t({search:e}).then((e=>{p(e),A(2),u(!1)})).finally((()=>v(!1)))}),i)),[t,i,x]);return(0,o.jsxs)(s.A,{showSearch:!0,allowClear:!0,onPopupScroll:async e=>{const i=e.target;h||i.scrollTop+i.offsetHeight!==i.scrollHeight||n&&(v(!0),i.scrollTo(0,i.scrollHeight),t({search:j,page:x}).then((e=>{A((e=>e+1)),p([...m,...e])})).finally((()=>v(!1))))},labelInValue:!0,filterOption:!1,onSearch:y,notFoundContent:d?(0,o.jsx)(a.A,{size:"small"}):"no results",onFocus:()=>{m.length||y("")},...c,children:[m.map(((e,t)=>(0,o.jsx)(s.A.Option,{value:e.value,children:e.label},t))),h&&(0,o.jsx)(s.A.Option,{children:(0,o.jsx)(a.A,{size:"small"})})]})}},47992:(e,t,i)=>{i.d(t,{G:()=>c});var r=i(9950),n=i(95491),l=i.n(n),s=i(99674),a=i(90650),o=i(44414);const c=e=>{let{fetchOptions:t,debounceTimeout:i=400,onClear:n,refetchOptions:c=!1,...d}=e;const[u,m]=(0,r.useState)(!1),[p,h]=(0,r.useState)([]),v=(0,r.useMemo)((()=>l()((e=>{h([]),m(!0),t(e).then((e=>{h(e),m(!1)}))}),i)),[t,i]);return(0,o.jsx)(s.A,{showSearch:!0,allowClear:!0,labelInValue:!0,filterOption:!1,onSearch:v,onClear:()=>{v(""),n&&n()},notFoundContent:u?(0,o.jsx)(a.A,{size:"small"}):"no results",...d,options:p,onFocus:()=>{p.length&&!c||v("")}})}},60925:(e,t,i)=>{i.r(t),i.d(t,{default:()=>A});var r=i(9950),n=i(28429),l=i(85923),s=i(86366),a=i(59233),o=i(23263),c=i(90650),d=i(63620),u=i(91854),m=i(74623),p=i(70030),h=i(71999),v=i(96210),j=i(5742),g=i(44414);const{Step:x}=s.A,A=()=>{var e,t,i;const{t:A}=(0,p.B)(),{activeMenu:y}=(0,u.d4)((e=>e.menu),u.bN),{id:b}=(0,n.g)(),f=(0,u.wA)(),{defaultLang:k}=(0,u.d4)((e=>e.formLang),u.bN),[w,_]=(0,r.useState)((null===(e=y.data)||void 0===e?void 0:e.step)||0),q=e=>({name:e,url:d.sE+e}),[I,P]=(0,r.useState)(null!==(t=y.data)&&void 0!==t&&t.galleries[0]?[q(y.data.galleries[0].path)]:[]),[E,C]=(0,r.useState)(null!==(i=y.data)&&void 0!==i&&i.galleries[1]?[q(y.data.galleries[1].path)]:[]),F=()=>{_(w+1)},S=()=>{_(w-1)},[N]=a.A.useForm(),L=(0,n.Zp)(),[O,T]=(0,r.useState)(!1),[B,V]=(0,r.useState)(!1);(0,r.useEffect)((()=>()=>{const e=N.getFieldsValue(!0);f((0,m.Ok)({activeMenu:y,data:e}))}),[]);const M=[...I,...E];return(0,r.useEffect)((()=>{y.refetch&&(e=>{T(!0),j.A.getById(e).then((e=>{var t,i,r;let n=e.data;N.setFieldsValue({...n,title:{[k]:n.translation.title},description:{[k]:n.translation.description},instruction:Object.assign({},...n.instructions.map((e=>({[e.locale]:e.title})))),ingredient:Object.assign({},...n.ingredients.map((e=>({[e.locale]:e.title})))),nutrition:null===(t=n.nutritions)||void 0===t?void 0:t.map((e=>{var t;return{percentage:null===e||void 0===e||null===(t=e.percentage)||void 0===t?void 0:t.toString(),weight:e.weight,...Object.assign({},...e.translations.flatMap((e=>({[e.locale]:e.title}))))}})),category_id:{value:n.category.id,label:null===(i=n.category.translation)||void 0===i?void 0:i.title},shop_id:{value:n.shop.id,label:null===(r=n.shop.translation)||void 0===r?void 0:r.title},stocks:n.stocks.map((e=>{var t,i;return{stock_id:{value:e.id,label:null===e||void 0===e||null===(t=e.product)||void 0===t||null===(i=t.translation)||void 0===i?void 0:i.title},...e}}))}),P([q(n.galleries[0].path)]),C([q(n.galleries[1].path)])})).finally((()=>{T(!1),f((0,m.km)(y))}))})(b)}),[y.refetch]),(0,g.jsx)(o.A,{title:A("edit.recepe"),extra:(0,g.jsx)(h.A,{}),children:O?(0,g.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:(0,g.jsx)(c.A,{size:"large",className:"py-5"})}):(0,g.jsxs)(a.A,{layout:"vertical",onFinish:e=>{var t;N.validateFields();const i={...e,category_id:e.category_id.value,images:M.map((e=>e.name)),shop_id:e.shop_id.value,active_time:e.active_time.toString(),total_time:e.total_time.toString(),nutrition:e.nutrition.map((e=>({...e,percentage:String(e.percentage),weight:String(e.weight)}))),stocks:null===(t=e.stocks)||void 0===t?void 0:t.map((e=>({min_quantity:e.min_quantity,stock_id:e.stock_id.value})))};V(!0);const r="catalog/recept";j.A.update(b,i).then((()=>{l.oR.success(A("successfully.updated")),L("/".concat(r)),f((0,m.EK)({...y,nextUrl:r}))})).finally((()=>V(!1)))},form:N,initialValues:{active:!0,...y.data},children:[(0,g.jsx)(s.A,{current:w,children:v.C.map((e=>(0,g.jsx)(x,{title:A(e.title)},e.title)))}),v.C.map((e=>{const t=e.content;return(0,g.jsx)("div",{className:"steps-content ".concat(e.step!==w+1&&"hidden"),children:(0,g.jsx)(t,{next:F,prev:S,loading:B,image:I,setImage:P,back:E,setBack:C})},e.title)}))]})})}},96210:(e,t,i)=>{i.d(t,{C:()=>N});var r=i(59233),n=i(87094),l=i(41988),s=i(80737),a=i(48538),o=i(9950),c=i(91854),d=i(36455),u=i(19181),m=i.n(u),p=i(70030),h=i(44414);const v=e=>{let{next:t,prev:i}=e;const{t:o}=(0,p.B)(),u=r.A.useFormInstance(),{defaultLang:v,languages:j}=(0,c.d4)((e=>e.formLang),c.bN);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(n.A,{gutter:12,children:(0,h.jsx)(l.A,{span:24,children:j.map((e=>(0,h.jsx)(r.A.Item,{label:o("ingredients"),name:["ingredient",e.locale],valuePropName:"data",getValueFromEvent:(e,t)=>t.getData(),rules:[{validator:(t,i)=>i||(null===e||void 0===e?void 0:e.locale)!==v?i&&(null===i||void 0===i?void 0:i.trim().length)<12?Promise.reject(new Error(o("must.be.at.least.5"))):Promise.resolve():Promise.reject(new Error(o("required")))}],hidden:e.locale!==v,children:(0,h.jsx)(d.CKEditor,{editor:m()})})))})}),(0,h.jsxs)(s.A,{children:[(0,h.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>i(),children:o("prev")}),(0,h.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>{u.validateFields([["ingredient",v]]).then((()=>{t()}))},children:o("next")})]})]})},j=e=>{let{next:t,prev:i}=e;const{t:o}=(0,p.B)(),u=r.A.useFormInstance(),{defaultLang:v,languages:j}=(0,c.d4)((e=>e.formLang),c.bN);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(n.A,{gutter:12,children:(0,h.jsx)(l.A,{span:24,children:j.map((e=>(0,h.jsx)(r.A.Item,{label:o("instructions"),name:["instruction",e.locale],valuePropName:"data",getValueFromEvent:(e,t)=>t.getData(),rules:[{validator:(t,i)=>i||(null===e||void 0===e?void 0:e.locale)!==v?i&&(null===i||void 0===i?void 0:i.trim().length)<12?Promise.reject(new Error(o("must.be.at.least.5"))):Promise.resolve():Promise.reject(new Error(o("required")))}],hidden:e.locale!==v,children:(0,h.jsx)(d.CKEditor,{editor:m()})})))})}),(0,h.jsxs)(s.A,{children:[(0,h.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>i(),children:o("prev")}),(0,h.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>{u.validateFields([["instruction",v]]).then((()=>{t()}))},children:o("next")})]})]})};var g=i(55902),x=i(40577),A=i(99674),y=i(48970),b=i(58547),f=i(47992),k=i(62572);const{TextArea:w}=g.A,_=e=>{let{next:t,image:i,setImage:s,back:o,setBack:d}=e;const{t:u}=(0,p.B)(),m=r.A.useFormInstance(),{defaultLang:v,languages:j}=(0,c.d4)((e=>e.formLang),c.bN);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(n.A,{gutter:12,children:[(0,h.jsx)(l.A,{span:8,children:j.map((e=>(0,h.jsx)(r.A.Item,{label:u("name"),name:["title",e.locale],rules:[{validator:(t,i)=>i||(null===e||void 0===e?void 0:e.locale)!==v?i&&""===(null===i||void 0===i?void 0:i.trim())?Promise.reject(new Error(u("no.empty.space"))):i&&(null===i||void 0===i?void 0:i.trim().length)<2?Promise.reject(new Error(u("must.be.at.least.2"))):Promise.resolve():Promise.reject(new Error(u("required")))}],hidden:e.locale!==v,children:(0,h.jsx)(g.A,{})},"name"+e.id)))}),(0,h.jsx)(l.A,{span:8,children:(0,h.jsx)(r.A.Item,{label:u("shop/restaurant"),name:"shop_id",rules:[{required:!0,message:u("required")}],children:(0,h.jsx)(f.G,{placeholder:u("select.shop"),fetchOptions:async function(e){const t={search:e,status:"approved"};return b.A.getAll(t).then((e=>{let{data:t}=e;return t.map((e=>{var t;return{label:null===(t=e.translation)||void 0===t?void 0:t.title,value:e.id}}))}))},style:{minWidth:150},allowClear:!1})})}),(0,h.jsx)(l.A,{span:8,children:(0,h.jsx)(r.A.Item,{label:u("category"),name:"category_id",rules:[{required:!0,message:u("required")}],children:(0,h.jsx)(f.G,{fetchOptions:function(e){const t={active:1,type:"receipt",search:e};return k.A.getAll(t).then((e=>e.data.map((e=>({label:e.translation.title,value:e.id})))))},placeholder:u("select.category"),style:{minWidth:150}})},"category_id")}),(0,h.jsx)(l.A,{span:24,children:j.map((e=>(0,h.jsx)(r.A.Item,{label:u("description"),name:["description",e.locale],rules:[{validator:(t,i)=>i||(null===e||void 0===e?void 0:e.locale)!==v?i&&""===(null===i||void 0===i?void 0:i.trim())?Promise.reject(new Error(u("no.empty.space"))):i&&(null===i||void 0===i?void 0:i.trim().length)<2?Promise.reject(new Error(u("must.be.at.least.2"))):Promise.resolve():Promise.reject(new Error(u("required")))}],hidden:e.locale!==v,children:(0,h.jsx)(w,{rows:3})},"description"+e.id)))}),(0,h.jsx)(l.A,{span:6,children:(0,h.jsx)(r.A.Item,{label:u("calories"),name:"calories",rules:[{required:!0,message:u("required")}],children:(0,h.jsx)(x.A,{className:"w-100",min:0})},"calories")}),(0,h.jsx)(l.A,{span:6,children:(0,h.jsx)(r.A.Item,{label:u("servings"),name:"servings",rules:[{required:!0,message:u("required")}],children:(0,h.jsx)(x.A,{className:"w-100",min:0})},"servings")}),(0,h.jsx)(l.A,{span:6,children:(0,h.jsx)(r.A.Item,{label:u("active.time"),name:"active_time",rules:[{required:!0,message:u("required")}],children:(0,h.jsx)(x.A,{className:"w-100",min:0})},"active_time")}),(0,h.jsx)(l.A,{span:6,children:(0,h.jsx)(r.A.Item,{label:u("total.time"),name:"total_time",rules:[{required:!0,message:u("required")}],children:(0,h.jsx)(x.A,{className:"w-100",min:0})},"total_time")}),(0,h.jsx)(l.A,{span:12,children:(0,h.jsx)(r.A.Item,{label:u("discount.type"),name:"discount_type",rules:[{required:!0,message:u("required")}],children:(0,h.jsx)(A.A,{options:[{label:u("fix"),value:"fix"},{label:u("percent"),value:"percent"}]})})}),(0,h.jsx)(l.A,{span:12,children:(0,h.jsx)(r.A.Item,{label:u("discount.price"),name:"discount_price",rules:[{required:!0,message:u("required")}],children:(0,h.jsx)(x.A,{className:"w-100",min:0})})}),(0,h.jsx)(l.A,{span:12,children:(0,h.jsx)(r.A.Item,{label:u("background"),name:"back_img",rules:[{validator:(e,t)=>0===(null===o||void 0===o?void 0:o.length)?Promise.reject(new Error(u("required"))):Promise.resolve()}],children:(0,h.jsx)(y.A,{type:"receipts",imageList:o,setImageList:d,form:m,multiple:!1})})}),(0,h.jsx)(l.A,{span:12,children:(0,h.jsx)(r.A.Item,{label:u("image"),name:"image",rules:[{validator:(e,t)=>0===(null===i||void 0===i?void 0:i.length)?Promise.reject(new Error(u("required"))):Promise.resolve()}],children:(0,h.jsx)(y.A,{type:"receipts",imageList:i,setImageList:s,form:m,multiple:!1})})})]}),(0,h.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>{m.validateFields([["title",v],["description",v],"calories","servings","active_time","total_time","discount_type","discount_price","category_id","shop_id","back_img","image"]).then((e=>{t()}))},children:u("next")})]})};var q=i(44070),I=i(8750);const{Option:P}=A.A,E=e=>{let{prev:t,loading:i}=e;const{t:o}=(0,p.B)(),{defaultLang:d,languages:u}=(0,c.d4)((e=>e.formLang),c.bN);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(n.A,{gutter:12,children:(0,h.jsx)(l.A,{span:24,children:(0,h.jsx)(r.A.List,{name:"nutrition",initialValue:[{weight:void 0,percentage:void 0,en:void 0,ru:void 0}],children:(e,t)=>{let{add:i,remove:s}=t;return(0,h.jsxs)(h.Fragment,{children:[e.map(((e,t)=>{let{key:i,name:c,...m}=e;return(0,h.jsxs)(n.A,{gutter:12,align:"middle",children:[(0,h.jsx)(l.A,{span:7,children:u.map((e=>(0,h.jsx)(r.A.Item,{label:o("name"),name:[c,e.locale],rules:[{validator:(t,i)=>i||(null===e||void 0===e?void 0:e.locale)!==d?i&&""===(null===i||void 0===i?void 0:i.trim())?Promise.reject(new Error(o("no.empty.space"))):i&&(null===i||void 0===i?void 0:i.trim().length)<2?Promise.reject(new Error(o("must.be.at.least.2"))):Promise.resolve():Promise.reject(new Error(o("required")))}],hidden:e.locale!==d,children:(0,h.jsx)(g.A,{})},"name"+e.id)))}),(0,h.jsx)(l.A,{span:7,children:(0,h.jsx)(r.A.Item,{...m,label:o("weight"),name:[c,"weight"],rules:[{validator:(e,t)=>t||0===t?t&&(t<0||t>191)?Promise.reject(new Error(o("must.be.between.0.and.191"))):Promise.resolve():Promise.reject(new Error(o("required")))}],children:(0,h.jsx)(x.A,{enterButton:!0,className:"w-100"})})}),(0,h.jsx)(l.A,{span:7,children:(0,h.jsx)(r.A.Item,{...m,label:o("percentage"),name:[c,"percentage"],rules:[{validator:(e,t)=>t||0===t?t&&(t<0||t>100)?Promise.reject(new Error(o("must.be.between.0.and.100"))):Promise.resolve():Promise.reject(new Error(o("required")))}],children:(0,h.jsx)(x.A,{addonAfter:"%",className:"w-100"})})}),0!==t&&(0,h.jsx)(l.A,{span:3,className:"d-flex justify-content-end",children:(0,h.jsx)(a.A,{onClick:()=>s(c),danger:!0,className:"w-100",type:"primary",icon:(0,h.jsx)(q.A,{})})})]})})),(0,h.jsx)(r.A.Item,{children:(0,h.jsx)(a.A,{onClick:()=>i(),block:!0,icon:(0,h.jsx)(I.A,{}),children:o("add.nutrition")})})]})}})})}),(0,h.jsxs)(s.A,{children:[(0,h.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>t(),children:o("prev")}),(0,h.jsx)(a.A,{type:"primary",htmlType:"submit",loading:i,children:o("submit")})]})]})};var C=i(47933),F=i(80905);const S=e=>{let{next:t,prev:i}=e;const{t:c}=(0,p.B)(),d=r.A.useFormInstance(),u=r.A.useWatch("stocks",d),m=r.A.useWatch("shop_id",d),[v,j]=(0,o.useState)(null);function g(e){let{search:t,page:i}=e;const r={search:0===(null===t||void 0===t?void 0:t.length)?void 0:t,shop_id:m.value,page:i,status:"published"};return C.A.getStock(r).then((e=>(j(e.links),e.data.filter((e=>!u.map((e=>{var t;return null===e||void 0===e||null===(t=e.stock_id)||void 0===t?void 0:t.value})).includes(e.id))).map((e=>({label:e.product.translation.title+" "+e.extras.map((e=>e.value)).join(", "),value:e.id}))))))}return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(n.A,{gutter:12,children:(0,h.jsx)(l.A,{span:24,children:(0,h.jsx)(r.A.List,{name:"stocks",initialValue:[{stock_id:void 0,min_quantity:void 0}],children:(e,t)=>{let{add:i,remove:s}=t;return(0,h.jsxs)(h.Fragment,{children:[e.map(((e,t)=>{let{key:i,name:o,...d}=e;return(0,h.jsxs)(n.A,{gutter:12,align:"middle",children:[(0,h.jsx)(l.A,{span:11,children:(0,h.jsx)(r.A.Item,{...d,label:c("stock"),name:[o,"stock_id"],rules:[{required:!0,message:c("required")}],children:(0,h.jsx)(F.j,{fetchOptions:g,debounceTimeout:200,hasMore:null===v||void 0===v?void 0:v.next})})}),(0,h.jsx)(l.A,{span:11,children:(0,h.jsx)(r.A.Item,{...d,label:c("min.quantity"),name:[o,"min_quantity"],rules:[{required:!0,message:c("required")}],children:(0,h.jsx)(x.A,{min:1,className:"w-100"})})}),0!==t&&(0,h.jsx)(l.A,{span:2,className:"d-flex justify-content-end",children:(0,h.jsx)(a.A,{onClick:()=>s(o),danger:!0,className:"w-100",type:"primary",icon:(0,h.jsx)(q.A,{})})})]})})),(0,h.jsx)(r.A.Item,{children:(0,h.jsx)(a.A,{onClick:()=>i(),block:!0,icon:(0,h.jsx)(I.A,{}),children:c("add.stock")})})]})}})})}),(0,h.jsxs)(s.A,{children:[(0,h.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>i(),children:c("prev")}),(0,h.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>{d.validateFields(u.flatMap(((e,t)=>[["stocks",t,"stock_id"],["stocks",t,"min_quantity"]]))).then((()=>{t()}))},children:c("next")})]})]})},N=[{step:1,title:"recipe",content:_},{step:2,title:"instructions",content:j},{step:3,title:"ingredients",content:v},{step:4,title:"stocks",content:S},{step:5,title:"nutritions",content:E}]}}]);