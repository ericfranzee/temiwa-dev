"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[651],{47992:(l,e,n)=>{n.d(e,{G:()=>u});var i=n(9950),t=n(95491),o=n.n(t),d=n(99674),a=n(90650),s=n(44414);const u=l=>{let{fetchOptions:e,debounceTimeout:n=400,onClear:t,refetchOptions:u=!1,...v}=l;const[r,c]=(0,i.useState)(!1),[m,h]=(0,i.useState)([]),x=(0,i.useMemo)((()=>o()((l=>{h([]),c(!0),e(l).then((l=>{h(l),c(!1)}))}),n)),[e,n]);return(0,s.jsx)(d.A,{showSearch:!0,allowClear:!0,labelInValue:!0,filterOption:!1,onSearch:x,onClear:()=>{x(""),t&&t()},notFoundContent:r?(0,s.jsx)(a.A,{size:"small"}):"no results",...v,options:m,onFocus:()=>{m.length&&!u||x("")}})}},80415:(l,e,n)=>{n.d(e,{G:()=>d,HV:()=>t,LH:()=>i,PR:()=>o,wO:()=>s,xt:()=>a});const i={new:[1,2,3,4,5],accepted:[1,2,3,4,5],ready:[1,2,3,4,5],on_a_way:[1,2,3,4,5],delivered:[1,2,3,4,5],canceled:[1,2,3,4,5],cooking:[1,2,3,4,5]},t=(new Date,new Date,["new","accepted","ready","on_a_way","pause","delivered","canceled"]),o=30,d="HH:mm",a="hh:mm a",s=!0},29597:(l,e,n)=>{function i(l){var e;if(null===l||void 0===l||!l.location)return{lat:47.4143302506288,lng:8.532059477976883};const n=null===l||void 0===l||null===(e=l.location)||void 0===e?void 0:e.split(", ");return{lat:Number(null===n||void 0===n?void 0:n[0]),lng:Number(null===n||void 0===n?void 0:n[1])}}n.d(e,{A:()=>i})},51066:(l,e,n)=>{n.d(e,{Q:()=>o});var i=n(17706),t=n(80415);const o=()=>{var l,e,n,o;return null!==(l=null===(e=i.M.getState())||void 0===e||null===(n=e.globalSettings)||void 0===n||null===(o=n.settings)||void 0===o?void 0:o.hour_format)&&void 0!==l?l:t.G}},6566:(l,e,n)=>{n.d(e,{A:()=>t});var i=n(17706);const t=()=>{var l,e;const n={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IS_DEMO:"false"}.MAP_API_KEY,{google_map_key:t}=null===(l=i.M.getState())||void 0===l||null===(e=l.globalSettings)||void 0===e?void 0:e.settings;return t||n}},53774:(l,e,n)=>{function i(){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"after";const n=Number(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,");return"after"===e?"".concat(n," ").concat(l):"".concat(l," ").concat(n)}n.r(e),n.d(e,{default:()=>i})},23283:(l,e,n)=>{n.d(e,{A:()=>p});var i=n(9950),t=n(59233),o=n(82706),d=n(48538),a=n(87094),s=n(41988),u=n(91854),v=n(23758),r=n(74623),c=n(70030),m=n(53271),h=n(47992),x=n(44414);function p(l){var e,n,p;let{orderDetails:j,handleCancel:g}=l;const{t:A}=(0,c.B)(),{activeMenu:f}=(0,u.d4)((l=>l.menu),u.bN),[y]=t.A.useForm(),b=(0,u.wA)(),[S,_]=(0,i.useState)(!1);return(0,x.jsx)(o.A,{visible:!!j,onCancel:g,footer:[(0,x.jsx)(d.A,{type:"primary",onClick:()=>y.submit(),loading:S,children:A("save")},"saveBtn"),(0,x.jsx)(d.A,{type:"default",onClick:g,children:A("cancel")},"cancelBtn")],children:(0,x.jsx)(t.A,{form:y,layout:"vertical",onFinish:l=>{const e={deliveryman_id:l.deliveryman.value};_(!0),v.A.updateDelivery(j.id,e).then((()=>{g(),b((0,r.Ms)(f))})).finally((()=>_(!1)))},initialValues:{deliveryman:{label:j.deliveryman?(null===j||void 0===j||null===(e=j.deliveryman)||void 0===e?void 0:e.firstname)+" "+(null===j||void 0===j||null===(n=j.deliveryman)||void 0===n?void 0:n.lastname):null,value:j.deliveryman?null===j||void 0===j||null===(p=j.deliveryman)||void 0===p?void 0:p.id:null}},children:(0,x.jsx)(a.A,{gutter:12,children:(0,x.jsx)(s.A,{span:24,children:(0,x.jsx)(t.A.Item,{label:A("deliveryman"),name:"deliveryman",rules:[{required:!0,message:A("required")}],children:(0,x.jsx)(h.G,{className:"w-100",debounceTimeout:500,placeholder:A("select.shop"),fetchOptions:async function(l){const e={search:l.length?l:void 0,page:1,perPage:10,role:"deliveryman",exist_token:1};return m.A.getAll(e).then((l=>{let{data:e}=l;return e.map((l=>({label:l.firstname+" "+l.lastname||"no name",value:l.id})))}))},allowClear:!0})})})})})})}},56592:(l,e,n)=>{n.d(e,{A:()=>_});var i=n(9950),t=n(98412),o=n(59233),d=n(82706),a=n(48538),s=n(87094),u=n(41988),v=n(55902),r=n(40895),c=n(99674),m=n(91854),h=n(70030),x=n(23758),p=n(81446),j=n(71999),g=n(59051),A=n.n(g),f=n(87210),y=n(24513),b=n(44414);const{Panel:S}=t.A;function _(l){var e;let{orderId:n,handleCancel:g,refetchPage:_}=l;const{statusList:w}=(0,m.d4)((l=>l.orderStatus),m.bN),{defaultLang:C,languages:k}=(0,m.d4)((l=>l.formLang),m.bN),[I]=o.A.useForm(),{t:N}=(0,h.B)(),D=(0,i.useRef)(null),[O,B]=(0,i.useState)(!1),[E,F]=(0,i.useState)(!1),[M,P]=(0,i.useState)(null!==w&&void 0!==w&&w.length?null===w||void 0===w?void 0:w.map((l=>({value:null===l||void 0===l?void 0:l.name,label:N(null===l||void 0===l?void 0:l.name),key:null===l||void 0===l?void 0:l.id}))):[]),[T,Y]=(0,i.useState)(null),[H,L]=(0,i.useState)(null),[R,z]=(0,i.useState)(null),[V,G]=(0,i.useState)(null);(0,i.useEffect)((()=>{B(!0),x.A.getById(n).then((l=>{var e,n,i,t;Y(l.data),L(null===(e=l.data)||void 0===e||null===(n=e.notes)||void 0===n?void 0:n.filter((l=>{var e;return!(null===l||void 0===l||null===(e=l.notes)||void 0===e||!e.length)}))),G(null===(i=l.data)||void 0===i?void 0:i.status),I.setFieldsValue({status:null===l||void 0===l||null===(t=l.data)||void 0===t?void 0:t.status})})).finally((()=>B(!1)))}),[n]),(0,i.useEffect)((()=>{var l,e;if("pause"===(null===T||void 0===T?void 0:T.status))return void P(null===w||void 0===w?void 0:w.map((l=>({value:null===l||void 0===l?void 0:l.name,label:N(null===l||void 0===l?void 0:l.name),key:null===l||void 0===l?void 0:l.id}))));const n=w.findIndex((l=>l.name===(null===T||void 0===T?void 0:T.status))),i=n>=0?[w[n],n<w.length-1?"pause"===(null===(l=w[n+1])||void 0===l?void 0:l.name)?w[n+2]:w[n+1]:null]:[n<w.length-1?w[n+1]:null];var t;("on_a_way"===(null===(e=w[n])||void 0===e?void 0:e.name)&&i.push(w[n+4]),null!==w&&void 0!==w&&w.filter((l=>"pause"===(null===l||void 0===l?void 0:l.name)&&(null===l||void 0===l?void 0:l.active))))&&(null===i||void 0===i||i.push(null===w||void 0===w||null===(t=w.filter((l=>"pause"===(null===l||void 0===l?void 0:l.name)&&(null===l||void 0===l?void 0:l.active))))||void 0===t?void 0:t[0]));i.push({name:"canceled",id:8,active:!0,sort:(null===w||void 0===w?void 0:w.length)+1}),P(i.filter(Boolean).map((l=>({value:null===l||void 0===l?void 0:l.name,label:N(null===l||void 0===l?void 0:l.name),key:null===l||void 0===l?void 0:l.id}))))}),[T]);const K=l=>{const e=Object.entries(l).filter((l=>{let[e,n]=l;return!!n}));if(0!==(null===e||void 0===e?void 0:e.length))return Object.fromEntries(e)};return(0,i.useEffect)((()=>{var l;I.setFieldsValue({["title[".concat(C||"en","]")]:null===R||void 0===R||null===(l=R.title)||void 0===l?void 0:l[C||"en"]})}),[C]),(0,b.jsx)(d.A,{visible:!!n,title:[N("order.status")],onCancel:g,footer:[(0,b.jsx)(a.A,{type:"primary",onClick:()=>I.submit(),loading:E,children:N("save")},"save-form"),(0,b.jsx)(a.A,{type:"default",onClick:g,children:N("cancel")},"cansel-modal")],children:O?(0,b.jsx)(p.A,{}):(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(o.A,{form:I,layout:"vertical",onFinish:l=>{var e;let n=null;F(!0),R&&(null===l||void 0===l?void 0:l.status)===(null===T||void 0===T?void 0:T.status)&&(n={...Object.assign({},...k.map((e=>({[e.locale]:l["title[".concat(e.locale,"]")]}))))},n=K(n));const i=K({...Object.assign({},...k.map((e=>({[e.locale]:l["note[".concat(e.locale,"]")]}))))}),t=i?{title:i}:null,o=(null===T||void 0===T?void 0:T.status)===(null===l||void 0===l?void 0:l.status)?null===T||void 0===T||null===(e=T.notes)||void 0===e?void 0:e.filter((e=>(null===e||void 0===e?void 0:e.status)===(null===l||void 0===l?void 0:l.status))).flatMap((l=>{var e;return null===l||void 0===l||null===(e=l.notes)||void 0===e?void 0:e.map(((l,e)=>e===(null===R||void 0===R?void 0:R.index)?{...l,title:{...null===l||void 0===l?void 0:l.title,...n}}:l))})).filter(Boolean):[],d={status:null===l||void 0===l?void 0:l.status,notes:[...o,t].filter(Boolean)};x.A.updateStatus(T.id,d).then((()=>{g(),_()})).finally((()=>F(!1)))},name:"order-status-change-form",children:[(0,b.jsx)(s.A,{gutter:12,style:{marginBottom:"20px"},children:(0,b.jsx)(u.A,{span:24,children:(0,b.jsx)(j.A,{})})}),!(null===T||void 0===T||null===(e=T.notes)||void 0===e||!e.some((l=>{var e;return!(null===l||void 0===l||null===(e=l.notes)||void 0===e||!e.length)})))&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.A,{children:null===H||void 0===H?void 0:H.map((l=>{var e;return(0,b.jsx)(S,{header:N(null===l||void 0===l?void 0:l.status),children:(null===l||void 0===l||null===(e=l.notes)||void 0===e?void 0:e.map(((e,n)=>{var i,t,d;return(0,b.jsxs)(s.A,{style:{marginBottom:"15px",display:"flex",justifyContent:"space-between"},gutter:12,children:[(0,b.jsxs)(u.A,{span:(null===l||void 0===l?void 0:l.status)===(null===T||void 0===T?void 0:T.status)&&V===(null===T||void 0===T?void 0:T.status)?22:24,children:[(0,b.jsxs)("div",{style:{display:"flex",columnGap:"10px"},children:[(0,b.jsxs)("span",{style:{marginTop:"3px"},children:[n+1,"."," "]}),(0,b.jsxs)("div",{style:{width:"100%"},children:[(0,b.jsx)("p",{style:{margin:0,fontSize:"15px",wordBreak:"break-all"},hidden:(null===R||void 0===R?void 0:R.orderId)===(null===l||void 0===l?void 0:l.id)&&(null===R||void 0===R?void 0:R.index)===n&&(null===T||void 0===T?void 0:T.status)===V,children:(null===e||void 0===e||null===(i=e.title)||void 0===i?void 0:i[C||"en"])||"--"}),(0,b.jsx)(o.A.Item,{name:"title[".concat(C||"en","]"),hidden:(null===R||void 0===R?void 0:R.orderId)!==(null===l||void 0===l?void 0:l.id)||(null===R||void 0===R?void 0:R.index)!==n||(null===T||void 0===T?void 0:T.status)!==V,children:(0,b.jsx)(v.A.TextArea,{maxLength:200,style:{width:"100%"},rows:Math.floor((null===e||void 0===e||null===(t=e.title)||void 0===t||null===(d=t[C||"en"])||void 0===d?void 0:d.length)/41||0)+1,ref:D},n)})]})]}),(0,b.jsx)("p",{style:{fontSize:"12px",margin:0,float:"right"},children:A()(null===e||void 0===e?void 0:e.created_at).format("DD-MM-YYYY HH:mm")})]}),(null===l||void 0===l?void 0:l.status)===(null===T||void 0===T?void 0:T.status)&&(null===T||void 0===T?void 0:T.status)===V&&(0,b.jsx)(u.A,{span:2,children:(null===R||void 0===R?void 0:R.orderId)===(null===l||void 0===l?void 0:l.id)&&n===(null===R||void 0===R?void 0:R.index)?(0,b.jsx)(a.A,{type:"primary",icon:(0,b.jsx)(f.A,{}),size:"small",onClick:()=>I.submit(),loading:E}):(null===l||void 0===l?void 0:l.status)===(null===T||void 0===T?void 0:T.status)&&(0,b.jsx)(a.A,{icon:(0,b.jsx)(y.A,{}),size:"small",onClick:()=>{var i;D.current.focus(),z({orderId:null===l||void 0===l?void 0:l.id,index:n,title:null===e||void 0===e?void 0:e.title}),I.setFieldsValue({["title[".concat(C||"en","]")]:null===e||void 0===e||null===(i=e.title)||void 0===i?void 0:i[C||"en"]})}})})]},n)})))||"--"},null===l||void 0===l?void 0:l.id)}))}),(0,b.jsx)(r.A,{})]}),(0,b.jsxs)(s.A,{gutter:12,children:[(0,b.jsx)(u.A,{span:24,children:(0,b.jsx)(o.A.Item,{label:N("status"),name:"status",rules:[{required:!0,message:N("required")}],children:(0,b.jsx)(c.A,{options:M,onSelect:l=>G(l)})})}),(0,b.jsx)(u.A,{span:24,children:k.map((l=>(0,b.jsx)(o.A.Item,{name:"note[".concat(null===l||void 0===l?void 0:l.locale,"]"),label:N("note"),hidden:(null===l||void 0===l?void 0:l.locale)!==C,children:(0,b.jsx)(v.A.TextArea,{maxLength:200})},"note_".concat(null===l||void 0===l?void 0:l.id))))})]})]})})})}},38635:(l,e,n)=>{n.d(e,{A:()=>O});var i=n(69286),t=n(86366),o=n(82706),d=n(48538),a=n(23263),s=n(87094),u=n(41988),v=n(12916),r=n(9950),c=n(70030),m=n(23758),h=n(81446),x=n(50384),p=n(91854),j=n(41478),g=n(29597),A=n(47965),f=n(31222),y=n(6604),b=n(68873),S=n(59051),_=n.n(S),w=n(6566),C=n(51066),k=n(44414);const I=(0,w.A)(),{Step:N}=t.A,D=()=>(0,k.jsx)("div",{style:{position:"absolute",transform:"translate(-50%, -100%)"},children:(0,k.jsx)("img",{src:j,width:"50",alt:"Pin"})}),O=l=>{var e,n,j;let{id:S,handleCancel:w}=l;const{t:O}=(0,c.B)(),[B,E]=(0,r.useState)(null),[F,M]=(0,r.useState)(null),[P,T]=(0,r.useState)(null),{settings:Y}=(0,p.d4)((l=>l.globalSettings),p.bN),H=(0,C.Q)(),L=(0,g.A)(Y),[R,z]=(0,r.useState)(0),[V,G]=(0,r.useState)({lat:null===L||void 0===L?void 0:L.lat,lng:null===L||void 0===L?void 0:L.lng}),[K,W]=(0,r.useState)([{id:0,name:"new",icon:(0,k.jsx)(A.A,{})},{id:1,name:"accepted",icon:(0,k.jsx)(x.LW,{})},{id:2,name:"ready",icon:(0,k.jsx)(f.NtI,{})},{id:3,name:"on_a_way",icon:(0,k.jsx)(y.o2P,{})},{id:4,name:"delivered",icon:(0,k.jsx)(y.eDZ,{})}]);const{google_map_key:q}=(0,p.d4)((l=>l.globalSettings.settings),p.bN);return(0,r.useEffect)((()=>{E(!0),m.A.getById(S).then((l=>{var e,n,i,t,o,d,a;let{data:s}=l;W("canceled"===s.status?[{id:1,name:"new",icon:(0,k.jsx)(A.A,{})},{id:5,name:"canceled",icon:(0,k.jsx)(b.XfH,{})}]:K),z("canceled"===s.status?1:null===(e=K.find((l=>l.name===s.status)))||void 0===e?void 0:e.id);const u=null!==(n=null!==(i=null!==(t=null===s||void 0===s||null===(o=s.address)||void 0===o?void 0:o.location)&&void 0!==t?t:null===s||void 0===s||null===(d=s.my_address)||void 0===d?void 0:d.location)&&void 0!==i?i:null===s||void 0===s||null===(a=s.delivery_point)||void 0===a?void 0:a.location)&&void 0!==n?n:{latitude:null===L||void 0===L?void 0:L.lat,longitude:null===L||void 0===L?void 0:L.lng};G({lat:Number(null===u||void 0===u?void 0:u.latitude),lng:Number(null===u||void 0===u?void 0:u.longitude)}),T("canceled"===s.status?"error":"success"),M(s)})).finally((()=>{E(!1)}))}),[]),(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(o.A,{visible:!!S,title:O("show.locations"),onCancel:()=>w(),style:{minWidth:"80vw"},footer:[(0,k.jsx)(d.A,{type:"default",onClick:w,children:O("cancel")},"cancelBtn")],children:B?(0,k.jsx)(h.A,{}):(0,k.jsxs)(a.A,{children:[(0,k.jsx)(t.A,{current:R,status:P,className:"mb-5",children:null===K||void 0===K?void 0:K.map(((l,e)=>(0,k.jsx)(N,{title:O(l.name),icon:null===l||void 0===l?void 0:l.icon},l.id+e)))}),(0,k.jsxs)(s.A,{gutter:12,children:[(0,k.jsxs)(u.A,{span:12,children:[(0,k.jsxs)("h3",{children:[O("order.id")," #",null===F||void 0===F?void 0:F.id]}),(0,k.jsxs)("p",{children:[(0,k.jsx)(x.A5h,{})," ",_()(null===F||void 0===F?void 0:F.created_at).format("YYYY-MM-DD ".concat(H))]}),(0,k.jsxs)("p",{children:[O("scheduled.at")," ",_()(null===F||void 0===F?void 0:F.delivery_date).format("YYYY-MM-DD ".concat(H))]})]}),(0,k.jsxs)(u.A,{span:12,children:[(0,k.jsxs)("p",{children:[O("status")," ","new"===(null===F||void 0===F?void 0:F.status)?(0,k.jsx)(v.A,{color:"blue",children:O(null===F||void 0===F?void 0:F.status)}):"canceled"===(null===F||void 0===F?void 0:F.status)?(0,k.jsx)(v.A,{color:"error",children:O(null===F||void 0===F?void 0:F.status)}):(0,k.jsx)(v.A,{color:"cyan",children:O(null===F||void 0===F?void 0:F.status)})]}),(0,k.jsxs)("p",{children:[O("payment.method")," ",(0,k.jsx)("strong",{children:null===F||void 0===F||null===(e=F.transaction)||void 0===e||null===(n=e.payment_system)||void 0===n?void 0:n.tag})]}),(0,k.jsxs)("p",{children:[O("order.type")," ",(0,k.jsx)("strong",{children:null===F||void 0===F?void 0:F.delivery_type})]}),(0,k.jsxs)("p",{children:[O("payment.type")," ",(0,k.jsx)("strong",{children:null===F||void 0===F||null===(j=F.transaction)||void 0===j?void 0:j.status})]})]}),(0,k.jsxs)(u.A,{span:24,className:"mt-5",children:[(0,k.jsx)("h4",{children:O("map")}),(0,k.jsx)("div",{className:"map-container",style:{height:400,width:"100%"},children:(0,k.jsx)(i.Ay,{bootstrapURLKeys:{key:I},defaultZoom:10,center:null!==V&&void 0!==V?V:L,options:{fullscreenControl:!1},children:(0,k.jsx)(D,{lat:null===V||void 0===V?void 0:V.lat,lng:null===V||void 0===V?void 0:V.lng})})})]})]})]})})})}},41478:(l,e,n)=>{l.exports=n.p+"static/media/user.fbe7078c52acde79652d.jpg"}}]);