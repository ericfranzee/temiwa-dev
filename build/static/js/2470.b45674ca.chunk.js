"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[2470],{80905:(e,t,r)=>{r.d(t,{j:()=>c});var n=r(9950),i=r(95491),s=r.n(i),l=r(99674),a=r(90650),o=r(44414);const c=e=>{let{fetchOptions:t,debounceTimeout:r=400,hasMore:i,...c}=e;const[d,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)([]),[p,v]=(0,n.useState)(!1),[j,x]=(0,n.useState)(null),[g,A]=(0,n.useState)(1),y=(0,n.useMemo)((()=>s()((e=>{h([]),x(e),u(!0),t({search:e}).then((e=>{h(e),A(2),u(!1)})).finally((()=>v(!1)))}),r)),[t,r,g]);return(0,o.jsxs)(l.A,{showSearch:!0,allowClear:!0,onPopupScroll:async e=>{const r=e.target;p||r.scrollTop+r.offsetHeight!==r.scrollHeight||i&&(v(!0),r.scrollTo(0,r.scrollHeight),t({search:j,page:g}).then((e=>{A((e=>e+1)),h([...m,...e])})).finally((()=>v(!1))))},labelInValue:!0,filterOption:!1,onSearch:y,notFoundContent:d?(0,o.jsx)(a.A,{size:"small"}):"no results",onFocus:()=>{m.length||y("")},...c,children:[m.map(((e,t)=>(0,o.jsx)(l.A.Option,{value:e.value,children:e.label},t))),p&&(0,o.jsx)(l.A.Option,{children:(0,o.jsx)(a.A,{size:"small"})})]})}},47992:(e,t,r)=>{r.d(t,{G:()=>c});var n=r(9950),i=r(95491),s=r.n(i),l=r(99674),a=r(90650),o=r(44414);const c=e=>{let{fetchOptions:t,debounceTimeout:r=400,onClear:i,refetchOptions:c=!1,...d}=e;const[u,m]=(0,n.useState)(!1),[h,p]=(0,n.useState)([]),v=(0,n.useMemo)((()=>s()((e=>{p([]),m(!0),t(e).then((e=>{p(e),m(!1)}))}),r)),[t,r]);return(0,o.jsx)(l.A,{showSearch:!0,allowClear:!0,labelInValue:!0,filterOption:!1,onSearch:v,onClear:()=>{v(""),i&&i()},notFoundContent:u?(0,o.jsx)(a.A,{size:"small"}):"no results",...d,options:h,onFocus:()=>{h.length&&!c||v("")}})}},92470:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var n=r(9950),i=r(28429),s=r(85923),l=r(86366),a=r(59233),o=r(23263),c=r(91854),d=r(74623),u=r(70030),m=r(71999),h=r(96210),p=r(5742),v=r(63620),j=r(44414);const{Step:x}=l.A,g=()=>{var e,t,r,g,A,y,b,k,w;const{t:f}=(0,u.B)(),{activeMenu:_}=(0,c.d4)((e=>e.menu),c.bN),q=(0,c.wA)(),[I]=a.A.useForm(),P=(0,i.Zp)(),C=e=>({name:e,url:v.sE+e}),[E,F]=(0,n.useState)(null!==(e=_.data)&&void 0!==e&&null!==(t=e.galleries)&&void 0!==t&&t[0]?[C(null===(r=_.data)||void 0===r||null===(g=r.galleries)||void 0===g?void 0:g[0].path)]:[]),[S,N]=(0,n.useState)(null!==(A=_.data)&&void 0!==A&&null!==(y=A.galleries)&&void 0!==y&&y[1]?[C(null===(b=_.data)||void 0===b||null===(k=b.galleries)||void 0===k?void 0:k[1].path)]:[]),T=[...E,...S],[L,O]=(0,n.useState)((null===(w=_.data)||void 0===w?void 0:w.step)||0),B=()=>{O(L+1)},V=()=>{O(L-1)},[M,z]=(0,n.useState)(!1);(0,n.useEffect)((()=>()=>{const e=I.getFieldsValue(!0);q((0,d.Ok)({activeMenu:_,data:e}))}),[]);return(0,j.jsx)(o.A,{title:f("add.recepe"),extra:(0,j.jsx)(m.A,{}),children:(0,j.jsxs)(a.A,{layout:"vertical",onFinish:e=>{var t;I.validateFields();const r={...e,images:T.map((e=>e.name)),category_id:e.category_id.value,shop_id:e.shop_id.value,active_time:e.active_time.toString(),total_time:e.total_time.toString(),nutrition:e.nutrition.map((e=>({...e,percentage:String(e.percentage),weight:String(e.weight)}))),stocks:null===(t=e.stocks)||void 0===t?void 0:t.map((e=>({min_quantity:e.min_quantity,stock_id:e.stock_id.value})))};z(!0);const n="catalog/recept";p.A.create(r).then((()=>{s.oR.success(f("successfully.created")),P("/".concat(n)),q((0,d.EK)({..._,nextUrl:n}))})).finally((()=>z(!1)))},form:I,initialValues:{active:!0,..._.data},children:[(0,j.jsx)(l.A,{current:L,children:h.C.map((e=>(0,j.jsx)(x,{title:f(e.title)},e.title)))}),h.C.map((e=>{const t=e.content;return(0,j.jsx)("div",{className:"steps-content ".concat(e.step!==L+1&&"hidden"),children:(0,j.jsx)(t,{next:B,prev:V,loading:M,image:E,setImage:F,back:S,setBack:N})},e.title)}))]})})}},96210:(e,t,r)=>{r.d(t,{C:()=>N});var n=r(59233),i=r(87094),s=r(41988),l=r(80737),a=r(48538),o=r(9950),c=r(91854),d=r(36455),u=r(19181),m=r.n(u),h=r(70030),p=r(44414);const v=e=>{let{next:t,prev:r}=e;const{t:o}=(0,h.B)(),u=n.A.useFormInstance(),{defaultLang:v,languages:j}=(0,c.d4)((e=>e.formLang),c.bN);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.A,{gutter:12,children:(0,p.jsx)(s.A,{span:24,children:j.map((e=>(0,p.jsx)(n.A.Item,{label:o("ingredients"),name:["ingredient",e.locale],valuePropName:"data",getValueFromEvent:(e,t)=>t.getData(),rules:[{validator:(t,r)=>r||(null===e||void 0===e?void 0:e.locale)!==v?r&&(null===r||void 0===r?void 0:r.trim().length)<12?Promise.reject(new Error(o("must.be.at.least.5"))):Promise.resolve():Promise.reject(new Error(o("required")))}],hidden:e.locale!==v,children:(0,p.jsx)(d.CKEditor,{editor:m()})})))})}),(0,p.jsxs)(l.A,{children:[(0,p.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>r(),children:o("prev")}),(0,p.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>{u.validateFields([["ingredient",v]]).then((()=>{t()}))},children:o("next")})]})]})},j=e=>{let{next:t,prev:r}=e;const{t:o}=(0,h.B)(),u=n.A.useFormInstance(),{defaultLang:v,languages:j}=(0,c.d4)((e=>e.formLang),c.bN);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.A,{gutter:12,children:(0,p.jsx)(s.A,{span:24,children:j.map((e=>(0,p.jsx)(n.A.Item,{label:o("instructions"),name:["instruction",e.locale],valuePropName:"data",getValueFromEvent:(e,t)=>t.getData(),rules:[{validator:(t,r)=>r||(null===e||void 0===e?void 0:e.locale)!==v?r&&(null===r||void 0===r?void 0:r.trim().length)<12?Promise.reject(new Error(o("must.be.at.least.5"))):Promise.resolve():Promise.reject(new Error(o("required")))}],hidden:e.locale!==v,children:(0,p.jsx)(d.CKEditor,{editor:m()})})))})}),(0,p.jsxs)(l.A,{children:[(0,p.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>r(),children:o("prev")}),(0,p.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>{u.validateFields([["instruction",v]]).then((()=>{t()}))},children:o("next")})]})]})};var x=r(55902),g=r(40577),A=r(99674),y=r(48970),b=r(58547),k=r(47992),w=r(62572);const{TextArea:f}=x.A,_=e=>{let{next:t,image:r,setImage:l,back:o,setBack:d}=e;const{t:u}=(0,h.B)(),m=n.A.useFormInstance(),{defaultLang:v,languages:j}=(0,c.d4)((e=>e.formLang),c.bN);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(i.A,{gutter:12,children:[(0,p.jsx)(s.A,{span:8,children:j.map((e=>(0,p.jsx)(n.A.Item,{label:u("name"),name:["title",e.locale],rules:[{validator:(t,r)=>r||(null===e||void 0===e?void 0:e.locale)!==v?r&&""===(null===r||void 0===r?void 0:r.trim())?Promise.reject(new Error(u("no.empty.space"))):r&&(null===r||void 0===r?void 0:r.trim().length)<2?Promise.reject(new Error(u("must.be.at.least.2"))):Promise.resolve():Promise.reject(new Error(u("required")))}],hidden:e.locale!==v,children:(0,p.jsx)(x.A,{})},"name"+e.id)))}),(0,p.jsx)(s.A,{span:8,children:(0,p.jsx)(n.A.Item,{label:u("shop/restaurant"),name:"shop_id",rules:[{required:!0,message:u("required")}],children:(0,p.jsx)(k.G,{placeholder:u("select.shop"),fetchOptions:async function(e){const t={search:e,status:"approved"};return b.A.getAll(t).then((e=>{let{data:t}=e;return t.map((e=>{var t;return{label:null===(t=e.translation)||void 0===t?void 0:t.title,value:e.id}}))}))},style:{minWidth:150},allowClear:!1})})}),(0,p.jsx)(s.A,{span:8,children:(0,p.jsx)(n.A.Item,{label:u("category"),name:"category_id",rules:[{required:!0,message:u("required")}],children:(0,p.jsx)(k.G,{fetchOptions:function(e){const t={active:1,type:"receipt",search:e};return w.A.getAll(t).then((e=>e.data.map((e=>({label:e.translation.title,value:e.id})))))},placeholder:u("select.category"),style:{minWidth:150}})},"category_id")}),(0,p.jsx)(s.A,{span:24,children:j.map((e=>(0,p.jsx)(n.A.Item,{label:u("description"),name:["description",e.locale],rules:[{validator:(t,r)=>r||(null===e||void 0===e?void 0:e.locale)!==v?r&&""===(null===r||void 0===r?void 0:r.trim())?Promise.reject(new Error(u("no.empty.space"))):r&&(null===r||void 0===r?void 0:r.trim().length)<2?Promise.reject(new Error(u("must.be.at.least.2"))):Promise.resolve():Promise.reject(new Error(u("required")))}],hidden:e.locale!==v,children:(0,p.jsx)(f,{rows:3})},"description"+e.id)))}),(0,p.jsx)(s.A,{span:6,children:(0,p.jsx)(n.A.Item,{label:u("calories"),name:"calories",rules:[{required:!0,message:u("required")}],children:(0,p.jsx)(g.A,{className:"w-100",min:0})},"calories")}),(0,p.jsx)(s.A,{span:6,children:(0,p.jsx)(n.A.Item,{label:u("servings"),name:"servings",rules:[{required:!0,message:u("required")}],children:(0,p.jsx)(g.A,{className:"w-100",min:0})},"servings")}),(0,p.jsx)(s.A,{span:6,children:(0,p.jsx)(n.A.Item,{label:u("active.time"),name:"active_time",rules:[{required:!0,message:u("required")}],children:(0,p.jsx)(g.A,{className:"w-100",min:0})},"active_time")}),(0,p.jsx)(s.A,{span:6,children:(0,p.jsx)(n.A.Item,{label:u("total.time"),name:"total_time",rules:[{required:!0,message:u("required")}],children:(0,p.jsx)(g.A,{className:"w-100",min:0})},"total_time")}),(0,p.jsx)(s.A,{span:12,children:(0,p.jsx)(n.A.Item,{label:u("discount.type"),name:"discount_type",rules:[{required:!0,message:u("required")}],children:(0,p.jsx)(A.A,{options:[{label:u("fix"),value:"fix"},{label:u("percent"),value:"percent"}]})})}),(0,p.jsx)(s.A,{span:12,children:(0,p.jsx)(n.A.Item,{label:u("discount.price"),name:"discount_price",rules:[{required:!0,message:u("required")}],children:(0,p.jsx)(g.A,{className:"w-100",min:0})})}),(0,p.jsx)(s.A,{span:12,children:(0,p.jsx)(n.A.Item,{label:u("background"),name:"back_img",rules:[{validator:(e,t)=>0===(null===o||void 0===o?void 0:o.length)?Promise.reject(new Error(u("required"))):Promise.resolve()}],children:(0,p.jsx)(y.A,{type:"receipts",imageList:o,setImageList:d,form:m,multiple:!1})})}),(0,p.jsx)(s.A,{span:12,children:(0,p.jsx)(n.A.Item,{label:u("image"),name:"image",rules:[{validator:(e,t)=>0===(null===r||void 0===r?void 0:r.length)?Promise.reject(new Error(u("required"))):Promise.resolve()}],children:(0,p.jsx)(y.A,{type:"receipts",imageList:r,setImageList:l,form:m,multiple:!1})})})]}),(0,p.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>{m.validateFields([["title",v],["description",v],"calories","servings","active_time","total_time","discount_type","discount_price","category_id","shop_id","back_img","image"]).then((e=>{t()}))},children:u("next")})]})};var q=r(44070),I=r(8750);const{Option:P}=A.A,C=e=>{let{prev:t,loading:r}=e;const{t:o}=(0,h.B)(),{defaultLang:d,languages:u}=(0,c.d4)((e=>e.formLang),c.bN);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.A,{gutter:12,children:(0,p.jsx)(s.A,{span:24,children:(0,p.jsx)(n.A.List,{name:"nutrition",initialValue:[{weight:void 0,percentage:void 0,en:void 0,ru:void 0}],children:(e,t)=>{let{add:r,remove:l}=t;return(0,p.jsxs)(p.Fragment,{children:[e.map(((e,t)=>{let{key:r,name:c,...m}=e;return(0,p.jsxs)(i.A,{gutter:12,align:"middle",children:[(0,p.jsx)(s.A,{span:7,children:u.map((e=>(0,p.jsx)(n.A.Item,{label:o("name"),name:[c,e.locale],rules:[{validator:(t,r)=>r||(null===e||void 0===e?void 0:e.locale)!==d?r&&""===(null===r||void 0===r?void 0:r.trim())?Promise.reject(new Error(o("no.empty.space"))):r&&(null===r||void 0===r?void 0:r.trim().length)<2?Promise.reject(new Error(o("must.be.at.least.2"))):Promise.resolve():Promise.reject(new Error(o("required")))}],hidden:e.locale!==d,children:(0,p.jsx)(x.A,{})},"name"+e.id)))}),(0,p.jsx)(s.A,{span:7,children:(0,p.jsx)(n.A.Item,{...m,label:o("weight"),name:[c,"weight"],rules:[{validator:(e,t)=>t||0===t?t&&(t<0||t>191)?Promise.reject(new Error(o("must.be.between.0.and.191"))):Promise.resolve():Promise.reject(new Error(o("required")))}],children:(0,p.jsx)(g.A,{enterButton:!0,className:"w-100"})})}),(0,p.jsx)(s.A,{span:7,children:(0,p.jsx)(n.A.Item,{...m,label:o("percentage"),name:[c,"percentage"],rules:[{validator:(e,t)=>t||0===t?t&&(t<0||t>100)?Promise.reject(new Error(o("must.be.between.0.and.100"))):Promise.resolve():Promise.reject(new Error(o("required")))}],children:(0,p.jsx)(g.A,{addonAfter:"%",className:"w-100"})})}),0!==t&&(0,p.jsx)(s.A,{span:3,className:"d-flex justify-content-end",children:(0,p.jsx)(a.A,{onClick:()=>l(c),danger:!0,className:"w-100",type:"primary",icon:(0,p.jsx)(q.A,{})})})]})})),(0,p.jsx)(n.A.Item,{children:(0,p.jsx)(a.A,{onClick:()=>r(),block:!0,icon:(0,p.jsx)(I.A,{}),children:o("add.nutrition")})})]})}})})}),(0,p.jsxs)(l.A,{children:[(0,p.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>t(),children:o("prev")}),(0,p.jsx)(a.A,{type:"primary",htmlType:"submit",loading:r,children:o("submit")})]})]})};var E=r(47933),F=r(80905);const S=e=>{let{next:t,prev:r}=e;const{t:c}=(0,h.B)(),d=n.A.useFormInstance(),u=n.A.useWatch("stocks",d),m=n.A.useWatch("shop_id",d),[v,j]=(0,o.useState)(null);function x(e){let{search:t,page:r}=e;const n={search:0===(null===t||void 0===t?void 0:t.length)?void 0:t,shop_id:m.value,page:r,status:"published"};return E.A.getStock(n).then((e=>(j(e.links),e.data.filter((e=>!u.map((e=>{var t;return null===e||void 0===e||null===(t=e.stock_id)||void 0===t?void 0:t.value})).includes(e.id))).map((e=>({label:e.product.translation.title+" "+e.extras.map((e=>e.value)).join(", "),value:e.id}))))))}return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.A,{gutter:12,children:(0,p.jsx)(s.A,{span:24,children:(0,p.jsx)(n.A.List,{name:"stocks",initialValue:[{stock_id:void 0,min_quantity:void 0}],children:(e,t)=>{let{add:r,remove:l}=t;return(0,p.jsxs)(p.Fragment,{children:[e.map(((e,t)=>{let{key:r,name:o,...d}=e;return(0,p.jsxs)(i.A,{gutter:12,align:"middle",children:[(0,p.jsx)(s.A,{span:11,children:(0,p.jsx)(n.A.Item,{...d,label:c("stock"),name:[o,"stock_id"],rules:[{required:!0,message:c("required")}],children:(0,p.jsx)(F.j,{fetchOptions:x,debounceTimeout:200,hasMore:null===v||void 0===v?void 0:v.next})})}),(0,p.jsx)(s.A,{span:11,children:(0,p.jsx)(n.A.Item,{...d,label:c("min.quantity"),name:[o,"min_quantity"],rules:[{required:!0,message:c("required")}],children:(0,p.jsx)(g.A,{min:1,className:"w-100"})})}),0!==t&&(0,p.jsx)(s.A,{span:2,className:"d-flex justify-content-end",children:(0,p.jsx)(a.A,{onClick:()=>l(o),danger:!0,className:"w-100",type:"primary",icon:(0,p.jsx)(q.A,{})})})]})})),(0,p.jsx)(n.A.Item,{children:(0,p.jsx)(a.A,{onClick:()=>r(),block:!0,icon:(0,p.jsx)(I.A,{}),children:c("add.stock")})})]})}})})}),(0,p.jsxs)(l.A,{children:[(0,p.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>r(),children:c("prev")}),(0,p.jsx)(a.A,{type:"primary",htmlType:"button",onClick:()=>{d.validateFields(u.flatMap(((e,t)=>[["stocks",t,"stock_id"],["stocks",t,"min_quantity"]]))).then((()=>{t()}))},children:c("next")})]})]})},N=[{step:1,title:"recipe",content:_},{step:2,title:"instructions",content:j},{step:3,title:"ingredients",content:v},{step:4,title:"stocks",content:S},{step:5,title:"nutritions",content:C}]}}]);