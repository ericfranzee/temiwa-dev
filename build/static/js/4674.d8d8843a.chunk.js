"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[4674],{44674:(e,o,l)=>{l.r(o),l.d(o,{default:()=>Y});var d=l(9950),i=l(86366),t=l(59233),n=l(23263),a=l(28429),s=l(91854),r=l(71999),u=l(70030),v=l(75482),m=l(73364),c=l(70364),_=l(82039),f=l(65820),g=l(74623),p=l(29597),y=l(59051),h=l.n(y),x=l(19689),A=l(33824),j=l(85923),F=l(62466),b=l(81446),N=l(44414);const{Step:S}=i.A;function Y(){var e,o,l,y,Y,k,M,H,C,D,E,w;const{t:O}=(0,u.B)(),[V]=t.A.useForm(),{id:z}=(0,a.g)(),B=(0,f.s)(),I=(0,s.wA)(),J=(0,a.Zp)(),{activeMenu:L}=(0,s.d4)((e=>e.menu),s.bN),{settings:R}=(0,s.d4)((e=>e.globalSettings),s.bN),{defaultCurrency:T}=(0,s.d4)((e=>e.currency),s.bN),K=Number((null===(e=B.values)||void 0===e?void 0:e.step)||0),[U,Z]=(0,d.useState)(!1),[q,G]=(0,d.useState)(!1),[P,Q]=(0,d.useState)((null===L||void 0===L||null===(o=L.data)||void 0===o?void 0:o.images)||[]),[W,X]=(0,d.useState)(null!==L&&void 0!==L&&null!==(l=L.data)&&void 0!==l&&l.location_from?{lat:parseFloat(null===L||void 0===L||null===(y=L.data)||void 0===y||null===(Y=y.location_from)||void 0===Y?void 0:Y.latitude),lng:parseFloat(null===L||void 0===L||null===(k=L.data)||void 0===k||null===(M=k.location_from)||void 0===M?void 0:M.longitude)}:(0,p.A)(R)),[$,ee]=(0,d.useState)(null!==L&&void 0!==L&&null!==(H=L.data)&&void 0!==H&&H.location_to?{lat:parseFloat(null===L||void 0===L||null===(C=L.data)||void 0===C||null===(D=C.location_to)||void 0===D?void 0:D.latitude),lng:parseFloat(null===L||void 0===L||null===(E=L.data)||void 0===E||null===(w=E.location_to)||void 0===w?void 0:w.longitude)}:(0,p.A)(R));(0,d.useEffect)((()=>()=>{const e=V.getFieldsValue(!0),o=JSON.stringify(e.delivery_date),l=JSON.stringify(e.delivery_time),d={...e,date:o,time:l};I((0,g.Ok)({activeMenu:L,data:d}))}),[]);const oe=()=>{const e=K+1;B.set("step",e)},le=()=>{const e=K-1;B.set("step",e)};(0,d.useEffect)((()=>{L.refetch&&z&&(e=>{Z(!0),x.A.getById(e).then((e=>{var o,l,d,i,t,n,a,s,r,u,v,m,c,_,f,p,y,x,A,j,b,N,S,Y,k;let M=e.data;Q([(0,F.A)(M.img)]),X({lat:null===M||void 0===M||null===(o=M.address_from)||void 0===o?void 0:o.latitude,lng:null===M||void 0===M||null===(l=M.address_from)||void 0===l?void 0:l.longitude}),ee({lat:null===M||void 0===M||null===(d=M.address_to)||void 0===d?void 0:d.latitude,lng:null===M||void 0===M||null===(i=M.address_to)||void 0===i?void 0:i.longitude});const H={...M,image:null!==M&&void 0!==M&&null!==(t=M.img)&&void 0!==t&&t.length?[(0,F.A)(null===M||void 0===M?void 0:M.img)]:void 0,delivery_time:null!==M&&void 0!==M&&M.delivery_date?h()(null===M||void 0===M?void 0:M.delivery_date,"YYYY-MM-DD HH:mm:ss"):null,delivery_date:null!==M&&void 0!==M&&M.delivery_date?h()(M.delivery_date,"YYYY-MM-DD"):null,address_from:null===M||void 0===M||null===(n=M.address_from)||void 0===n?void 0:n.address,address_to:null===M||void 0===M||null===(a=M.address_to)||void 0===a?void 0:a.address,house_from:null===M||void 0===M||null===(s=M.address_from)||void 0===s?void 0:s.house,house_to:null===M||void 0===M||null===(r=M.address_to)||void 0===r?void 0:r.house,stage_from:null===M||void 0===M||null===(u=M.address_from)||void 0===u?void 0:u.stage,stage_to:null===M||void 0===M||null===(v=M.address_to)||void 0===v?void 0:v.stage,room_from:null===M||void 0===M||null===(m=M.address_from)||void 0===m?void 0:m.room,room_to:null===M||void 0===M||null===(c=M.address_to)||void 0===c?void 0:c.room,user_from:{label:[null===(_=M.user)||void 0===_?void 0:_.firstname,null===(f=M.user)||void 0===f?void 0:f.lastname].join(" "),value:null===(p=M.user)||void 0===p?void 0:p.id,key:null===(y=M.user)||void 0===y?void 0:y.id},type:{label:null===(x=M.type)||void 0===x?void 0:x.type,value:null===(A=M.type)||void 0===A?void 0:A.id,key:null===(j=M.type)||void 0===j?void 0:j.id},payment_type:{label:O(null===M||void 0===M||null===(b=M.transaction)||void 0===b?void 0:b.payment_system.tag),value:null===M||void 0===M||null===(N=M.transaction)||void 0===N||null===(S=N.payment_system)||void 0===S?void 0:S.id,key:null===M||void 0===M||null===(Y=M.transaction)||void 0===Y||null===(k=Y.payment_system)||void 0===k?void 0:k.id}};V.setFieldsValue(H),I((0,g.Ok)({activeMenu:L,data:H}))})).finally((()=>{Z(!1),I((0,g.km)(L))}))})(z)}),[L.refetch]);return(0,N.jsxs)(n.A,{title:O(z?"edit.parcel.order":"add.parcel.order"),extra:(0,N.jsx)(r.A,{}),children:[(0,N.jsx)(i.A,{current:K,onChange:e=>{B.set("step",e)},children:v.C.map((e=>(0,N.jsx)(S,{title:O(e.title)},e.title)))}),(0,N.jsx)("div",{className:"steps-content",children:U?(0,N.jsx)(b.A,{}):(0,N.jsxs)(t.A,{form:V,name:"parcel-create",layout:"vertical",onFinish:e=>{var o,l,d;G(!0);const i=null===(o=h()(e.delivery_time,"HH:mm").format("HH:mm"))||void 0===o?void 0:o.split(":"),t=new Date(e.delivery_date);t.setHours(Number(i[0])),t.setMinutes(Number(i[1]));const n={user_id:null===(l=e.user_from)||void 0===l?void 0:l.value,currency_id:null===T||void 0===T?void 0:T.id,type_id:null===(d=e.type)||void 0===d?void 0:d.value,rate:null===T||void 0===T?void 0:T.rate,phone_from:e.phone_from.toString(),username_from:e.username_from,address_from:{longitude:null===W||void 0===W?void 0:W.lng,latitude:null===W||void 0===W?void 0:W.lat,address:e.address_from,house:e.house_from,stage:e.stage_from,room:e.room_from},phone_to:e.phone_to.toString(),username_to:e.username_to,address_to:{longitude:null===$||void 0===$?void 0:$.lng,latitude:null===$||void 0===$?void 0:$.lat,address:e.address_to,house:e.house_to,stage:e.stage_to,room:e.room_to},delivery_date:h()(t).format("YYYY-MM-DD HH:mm"),note:e.note,images:P.map((e=>e.name))},a="parcel-orders";x.A.update(z,n).then((()=>{I((0,A.xj)()),j.oR.success(O("successfully.created")),I((0,g.EK)({...L,nextUrl:a})),J("/".concat(a))})).finally((()=>G(!1)))},initialValues:{...L.data},onFinishFailed:e=>{const o=["","",""];e.errorFields.map((e=>e.name[0])).forEach((e=>{e.includes("_from")?o[0]="sender.details.invalid":e.includes("_to")?o[1]="receiver.details.invalid":o[2]="parcel.details.invalid"})),o.forEach((e=>{e&&j.oR.error(O(e))}))},children:[(0,N.jsx)("div",{className:"First-content"===v.C[K].content?"":"d-none",children:(0,N.jsx)(m.A,{form:V,next:oe,location:W,setLocation:X})}),(0,N.jsx)("div",{className:"Second-content"===v.C[K].content?"":"d-none",children:(0,N.jsx)(c.A,{form:V,next:oe,prev:le,location:$,setLocation:ee})}),(0,N.jsx)("div",{className:"Third-content"===v.C[K].content?"":"d-none",children:(0,N.jsx)(_.A,{form:V,loading:q,prev:le,locationFrom:W,locationTo:$,image:P,setImage:Q})})]})})]})}}}]);