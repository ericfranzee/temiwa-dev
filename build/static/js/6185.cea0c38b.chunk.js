"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[6185],{86185:(e,r,i)=>{i.r(r),i.d(r,{default:()=>P});var a=i(59233),l=i(23263),t=i(80737),s=i(48538),d=i(87094),n=i(41988),o=i(55902),c=i(40577),m=i(86971),u=i(15249),p=i(59051),v=i.n(p),x=i(9950),g=i(70030),h=i(91854),j=i(85923),f=i(74623),b=i(82371);const A={get:e=>b.A.get("dashboard/admin/referrals",{params:e}),update:e=>b.A.post("dashboard/admin/referrals",{},{params:e})};var _=i(9690),w=i(71999),q=i(48970),y=i(44414);const P=()=>{var e,r;const{t:i}=(0,g.B)(),[p]=a.A.useForm(),{activeMenu:b}=(0,h.d4)((e=>e.menu),h.bN),P=(0,h.wA)(),{settings:E}=(0,h.d4)((e=>e.globalSettings)),N=Number(E.referral_active),[I,k]=(0,x.useState)(!1),[S,F]=(0,x.useState)(!1),{defaultLang:L,languages:M}=(0,h.d4)((e=>e.formLang),h.bN),[O,Y]=(0,x.useState)(null!==(e=b.data)&&void 0!==e&&e.logo_img?[null===(r=b.data)||void 0===r?void 0:r.logo_img]:[]);function C(e){if(null===e||void 0===e||!e.translations)return{};const{translations:r}=e,i=M.map((e=>{var i,a,l;return{["title[".concat(e.locale,"]")]:null===(i=r.find((r=>r.locale===e.locale)))||void 0===i?void 0:i.title,["description[".concat(e.locale,"]")]:null===(a=r.find((r=>r.locale===e.locale)))||void 0===a?void 0:a.description,["faq[".concat(e.locale,"]")]:null===(l=r.find((r=>r.locale===e.locale)))||void 0===l?void 0:l.faq}}));return Object.assign({},...i)}(0,x.useEffect)((()=>()=>{const e=p.getFieldsValue(!0);e.expired_at=JSON.stringify(null===e||void 0===e?void 0:e.expired_at),P((0,f.Ok)({activeMenu:b,data:e}))}),[]);const D=e=>({items:e,uid:e,url:e,name:e});return(0,x.useEffect)((()=>{b.refetch&&(k(!0),A.get().then((e=>{const r=e.data[0],i={...C(r),price_from:r.price_from,price_to:r.price_to,expired_at:r.expired_at?v()(r.expired_at):void 0,active:r.active,image:[D(r.img)]};p.setFieldsValue(i),Y([D(r.img)])})).finally((()=>{k(!1),P((0,f.km)(b))})))}),[b.refetch]),(0,y.jsx)(l.A,{title:i("referral.settings"),loading:I,extra:(0,y.jsxs)(t.A,{children:[(0,y.jsx)(w.A,{}),(0,y.jsx)(s.A,{type:"primary",onClick:()=>p.submit(),loading:S,disabled:1!==N,children:i("save")})]}),children:(0,y.jsx)(a.A,{layout:"vertical",initialValues:{...b.data,active:!0,...(()=>{var e,r;if(null===(e=b.data)||void 0===e||!e.expired_at)return{};const i=JSON.parse(null===(r=b.data)||void 0===r?void 0:r.expired_at);return{expired_at:v()(i,"HH:mm:ss")}})()},form:p,onFinish:e=>{const r={...e,expired_at:v()(e.expired_at).format("YYYY-MM-DD"),img:O[0].name};F(!0),A.update(r).then((()=>{j.oR.success(i("successfully.updated")),P((0,_.Uc)())})).finally((()=>F(!1)))},name:"referral-settings",children:(0,y.jsxs)(d.A,{gutter:24,children:[(0,y.jsx)(n.A,{span:24,children:1!==N?(0,y.jsx)("h3",{className:"text-center mt-2 mb-4",children:i("no.active.referral")}):null}),(0,y.jsx)(n.A,{span:12,children:M.map(((e,r)=>(0,y.jsx)(a.A.Item,{label:i("title"),name:"title[".concat(e.locale,"]"),rules:[{validator:(r,a)=>a||(null===e||void 0===e?void 0:e.locale)!==L?a&&""===(null===a||void 0===a?void 0:a.trim())?Promise.reject(new Error(i("no.empty.space"))):a&&(null===a||void 0===a?void 0:a.trim().length)<2?Promise.reject(new Error(i("must.be.at.least.2"))):Promise.resolve():Promise.reject(new Error(i("required")))}],hidden:e.locale!==L,children:(0,y.jsx)(o.A,{disabled:1!==N})},"title"+r)))}),(0,y.jsx)(n.A,{span:12,children:M.map(((e,r)=>(0,y.jsx)(a.A.Item,{label:i("description"),name:"description[".concat(e.locale,"]"),rules:[{validator:(r,a)=>a||(null===e||void 0===e?void 0:e.locale)!==L?a&&""===(null===a||void 0===a?void 0:a.trim())?Promise.reject(new Error(i("no.empty.space"))):a&&(null===a||void 0===a?void 0:a.trim().length)<5?Promise.reject(new Error(i("must.be.at.least.5"))):Promise.resolve():Promise.reject(new Error(i("required")))}],hidden:e.locale!==L,children:(0,y.jsx)(u.A,{rows:3,disabled:1!==N})},"description"+r)))}),(0,y.jsx)(n.A,{span:12,children:(0,y.jsx)(a.A.Item,{name:"price_from",label:i("sender.price"),rules:[{required:!0,message:i("required")},{type:"number",min:0,message:i("must.be.positive")}],children:(0,y.jsx)(c.A,{className:"w-100",disabled:1!==N})})}),(0,y.jsx)(n.A,{span:12,children:M.map(((e,r)=>(0,y.jsx)(a.A.Item,{label:i("terms"),name:"faq[".concat(e.locale,"]"),rules:[{validator:(r,a)=>a||(null===e||void 0===e?void 0:e.locale)!==L?a&&""===(null===a||void 0===a?void 0:a.trim())?Promise.reject(new Error(i("no.empty.space"))):a&&(null===a||void 0===a?void 0:a.trim().length)<2?Promise.reject(new Error(i("must.be.at.least.2"))):Promise.resolve():Promise.reject(new Error(i("required")))}],hidden:e.locale!==L,children:(0,y.jsx)(u.A,{rows:3,disabled:1!==N})},"terms"+r)))}),(0,y.jsx)(n.A,{span:12,children:(0,y.jsx)(a.A.Item,{name:"price_to",label:i("distribution.price"),rules:[{required:!0,message:i("required")},{type:"number",min:0,message:i("must.be.positive")}],children:(0,y.jsx)(c.A,{className:"w-100",disabled:1!==N})})}),(0,y.jsx)(n.A,{span:12,children:(0,y.jsx)(a.A.Item,{name:"expired_at",label:i("expired.at"),rules:[{required:!0,message:i("required")}],children:(0,y.jsx)(m.A,{className:"w-100",disabledDate:e=>v()().add(-1,"days")>=e,disabled:1!==N})})}),(0,y.jsx)(n.A,{span:12,disabled:1!==N,children:(0,y.jsx)(a.A.Item,{label:i("image"),disabled:1!==N,name:"images",rules:[{required:0===O.length,message:i("required")}],children:(0,y.jsx)(q.A,{type:"referral",imageList:O,setImageList:Y,form:p,multiple:!1,name:"referral",disabled:1!==N})})})]})})})}}}]);